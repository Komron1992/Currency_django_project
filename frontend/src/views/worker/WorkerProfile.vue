<template>
  <div class="min-h-screen bg-gray-50">
    <div class="max-w-4xl mx-auto py-8 px-4">
      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
      <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h1>
        <p class="mt-2 text-gray-600">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–Ω–∏–∫–µ</p>
      </div>

      <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
      <div class="profile-card">
        <div class="profile-header">
          <div class="profile-avatar">
            <span class="avatar-text">
              {{ getUserInitial }}
            </span>
          </div>
          <div class="profile-info">
            <h2 class="profile-name">{{ getUserName }}</h2>
            <p class="profile-email">{{ getUserEmail }}</p>
            <div class="profile-meta">
              <span class="meta-item">
                <span class="meta-icon">üè¢</span>
                –†–∞–±–æ—Ç–Ω–∏–∫
              </span>
              <span class="meta-item">
                <span class="meta-icon">üìç</span>
                {{ getUserCity }}
              </span>
              <span class="meta-item">
                <span class="meta-icon">üìÖ</span>
                {{ formatDate(authStore.user?.date_joined) }}
              </span>
            </div>
          </div>
          <div class="profile-status">
            <div class="status-indicator active"></div>
            <span class="status-text">–ê–∫—Ç–∏–≤–µ–Ω</span>
          </div>
        </div>
      </div>

      <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
      <div class="profile-card">
        <div class="profile-section">
          <h3 class="section-title">–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
          <div class="info-grid">
            <div class="info-item">
              <label class="info-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
              <div class="info-value">{{ getUserName }}</div>
            </div>
            <div class="info-item">
              <label class="info-label">Email</label>
              <div class="info-value">{{ getUserEmail }}</div>
            </div>
            <div class="info-item">
              <label class="info-label">–ò–º—è</label>
              <div class="info-value">{{ getUserFirstName }}</div>
            </div>
            <div class="info-item">
              <label class="info-label">–§–∞–º–∏–ª–∏—è</label>
              <div class="info-value">{{ getUserLastName }}</div>
            </div>
            <div class="info-item">
              <label class="info-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
              <div class="info-value">{{ getUserPhone }}</div>
            </div>
            <div class="info-item">
              <label class="info-label">–ì–æ—Ä–æ–¥</label>
              <div class="info-value">{{ getUserCity }}</div>
            </div>
          </div>
        </div>

        <div class="profile-section">
          <h3 class="section-title">–°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
          <div class="info-grid">
            <div class="info-item">
              <label class="info-label">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</label>
              <div class="info-value">{{ formatDate(authStore.user?.date_joined) }}</div>
            </div>
            <div class="info-item">
              <label class="info-label">–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥</label>
              <div class="info-value">{{ formatDate(authStore.user?.last_login) }}</div>
            </div>
            <div class="info-item">
              <label class="info-label">–°—Ç–∞—Ç—É—Å</label>
              <div class="info-value">
                <span class="status-badge active">–ê–∫—Ç–∏–≤–µ–Ω</span>
              </div>
            </div>
            <div class="info-item">
              <label class="info-label">–†–æ–ª—å</label>
              <div class="info-value">
                <span class="role-badge">–†–∞–±–æ—Ç–Ω–∏–∫</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import '@/assets/styles/views/worker/WorkerProfile.css'
import { onMounted, computed } from 'vue'
import { useAuthStore } from '../../stores/auth'

const authStore = useAuthStore()

// Computed —Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
const getUserName = computed(() => authStore.user?.username || '–ù–µ —É–∫–∞–∑–∞–Ω–æ')
const getUserEmail = computed(() => authStore.user?.email || '–ù–µ —É–∫–∞–∑–∞–Ω')
const getUserFirstName = computed(() => authStore.user?.first_name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ')
const getUserLastName = computed(() => authStore.user?.last_name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ')
const getUserPhone = computed(() => authStore.user?.phone || '–ù–µ —É–∫–∞–∑–∞–Ω')
const getUserCity = computed(() => {
  return authStore.userCity ||
         authStore.user?.city_name ||
         authStore.user?.city ||
         authStore.user?.profile?.city ||
         '–ù–µ —É–∫–∞–∑–∞–Ω'
})
const getUserInitial = computed(() => {
  const username = authStore.user?.username
  return username ? username.charAt(0).toUpperCase() : '?'
})

onMounted(async () => {
  if (!authStore.user) {
    try {
      await authStore.fetchUser()
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error)
    }
  }
})

const formatDate = (dateString) => {
  if (!dateString || dateString === null) return '–ù–µ —É–∫–∞–∑–∞–Ω–æ'

  try {
    const date = new Date(dateString)
    if (isNaN(date.getTime())) return '–ù–µ —É–∫–∞–∑–∞–Ω–æ'

    return date.toLocaleDateString('ru-RU', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    })
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–∞—Ç—ã:', error)
    return '–ù–µ —É–∫–∞–∑–∞–Ω–æ'
  }
}
</script>
